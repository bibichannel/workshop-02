<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.126.1"><meta name=description content><meta name=author content="journeyoftheaverageguy@gmail.com"><link rel=icon href=https://bibichannel.github.io/workshop-02/images/favicon.png type=image/png><title>Terraform IaC to AWS Cloud :: Development & Deployment static website to AWS Cloud</title>
<link href=https://bibichannel.github.io/workshop-02/css/nucleus.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/fontawesome-all.min.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/hybrid.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/featherlight.min.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/perfect-scrollbar.min.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/auto-complete.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/atom-one-dark-reasonable.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/theme.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/hugo-theme.css?1716562458 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/theme-workshop.css?1716562458 rel=stylesheet><script src=https://bibichannel.github.io/workshop-02/js/jquery-3.3.1.min.js?1716562458></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://bibichannel.github.io/workshop-02/3-setupgithub/3.1-createterraformrepo/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://bibichannel.github.io/workshop-02/><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://bibichannel.github.io/workshop-02/js/lunr.min.js?1716562458></script><script type=text/javascript src=https://bibichannel.github.io/workshop-02/js/auto-complete.js?1716562458></script><script type=text/javascript>var baseurl="https://bibichannel.github.io/workshop-02/"</script><script type=text/javascript src=https://bibichannel.github.io/workshop-02/js/search.js?1716562458></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-introduce/ title=Introduction class=dd-item><a href=https://bibichannel.github.io/workshop-02/1-introduce/><b>1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/ title="Preparation " class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/><b>2. </b>Preparation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/2-prerequisites/2.1-createiam/ title="Create User Groups and IAM User" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.1-createiam/><b>2.1 </b>Create User Groups and IAM User
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.2-createoidc/ title="Create OIDC" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.2-createoidc/><b>2.2 </b>Create OIDC
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.3-createbucket/ title="Create S3 bucket" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.3-createbucket/><b>2.3 </b>Create S3 bucket
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.4-createcodestar/ title="Create CodeStar Connection" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.4-createcodestar/><b>2.4 </b>Create CodeStar Connection
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.5-installtools/ title="Install tools" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.5-installtools/><b>2.5 </b>Install tools
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/3-setupgithub/ title="Prepare github repository" class="dd-item
parent"><a href=https://bibichannel.github.io/workshop-02/3-setupgithub/><b>3. </b>Prepare github repository
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-setupgithub/3.1-createterraformrepo/ title="Terraform IaC to AWS Cloud" class="dd-item
active"><a href=https://bibichannel.github.io/workshop-02/3-setupgithub/3.1-createterraformrepo/><b>3.1 </b>Terraform IaC to AWS Cloud
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-setupgithub/3.2-createstreamlitrepo/ title="Streamlit application" class=dd-item><a href=https://bibichannel.github.io/workshop-02/3-setupgithub/3.2-createstreamlitrepo/><b>3.2 </b>Streamlit application
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-knowledgeterraform/ title="Knowledge Terraform" class=dd-item><a href=https://bibichannel.github.io/workshop-02/4-knowledgeterraform/><b>4. </b>Knowledge Terraform
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-knowledgeterraform/4.1-overview/ title=Overview class=dd-item><a href=https://bibichannel.github.io/workshop-02/4-knowledgeterraform/4.1-overview/><b>4.1 </b>Overview
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-knowledgeterraform/4.2-terraformflow/ title="Terrafrom flow" class=dd-item><a href=https://bibichannel.github.io/workshop-02/4-knowledgeterraform/4.2-terraformflow/><b>4.2 </b>Terrafrom flow
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-provisioningtesting/ title="Provisioning & Testing" class=dd-item><a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/><b>5. </b>Provisioning & Testing
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-provisioningtesting/5.1-local/ title=Local class=dd-item><a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.1-local/><b>5.1 </b>Local
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-provisioningtesting/5.2-githubaction/ title="Git action" class=dd-item><a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.2-githubaction/><b>5.2 </b>Git action
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-cleanup/ title="Resource Cleanup" class=dd-item><a href=https://bibichannel.github.io/workshop-02/6-cleanup/><b>7. </b>Resource Cleanup
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://bibichannel.github.io/workshop-02/3-setupgithub/3.1-createterraformrepo/ selected>English</option><option id=vi value=https://bibichannel.github.io/workshop-02/vi/3-setupgithub/3.1-createterraformrepo/>Tiếng Việt</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><font color=orange>30-01-2022</font></i>
</left><left><br><br><b>Team</b><br><i><a href=https://www.linkedin.com/in/sutrinh/ style=color:orange>Sử Trịnh</a><br><a href=https://www.linkedin.com/in/jotaguy style=color:orange>Gia Hưng</a><br><a href=https://www.linkedin.com/in/hiepnguyendt style=color:orange>Thanh Hiệp </a></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://bibichannel.github.io/workshop-02/3-setupGithub/3.1-createTerraformRepo/_index.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://bibichannel.github.io/workshop-02/>Create a complete project with Terraform and AWS services</a> > <a href=https://bibichannel.github.io/workshop-02/3-setupgithub/>Prepare github repository</a> > Terraform IaC to AWS Cloud</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Terraform IaC to AWS Cloud</h1><h4 id=the-source-code-for-this-part-is-available-here>The source code for this part is available here:</h4><ul><li><a href=https://github.com/bibichannel/terraform-aws-continuous-docker-deployment-to-aws-fargate>terraform-aws-continuous-docker-deployment-to-aws-fargate</a>.</li></ul><h4 id=you-can-fork-it-directly-from-my-repository>You can fork it directly from my repository:</h4><ul><li><p>With the <strong>Repository name</strong> matching the one you set when creating the role for OIDC in <a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.2-createoidc/>step 2.2</a>.</p></li><li><p>Click <strong>Create fork</strong>.</p></li><li><p>In the repository interface you just created or forked, go to <strong>settings</strong>.</p></li><li><p>Select <strong>Secrets and variables</strong>, then click <strong>Actions</strong>.</p></li><li><p>We will proceed to create <strong>2 new repository secrets</strong> with the following content:</p><ul><li><code>TERRAFORM_BUCKET_NAME</code>: the name of the <strong>bucket</strong> you created in <a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.3-createbucket/>step 2.3</a>.</li><li><code>CODESTAR_CONNECTION_ARN</code>: containing the ARN of the <strong>connection</strong> we created in <a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.4-createcodestar/>step 2.4</a>.</li></ul></li></ul><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/3-setupGithub/3.1-createTerraformRepo/002-createTerraformRepo.png></p><p>With these 2 secret variables, they will be used during the action execution when the GitHub workflow is activated.</p><h4 id=lets-briefly-explore-the-components-in-this-repository>Let&rsquo;s briefly explore the components in this repository</h4><p>The directory structure of this repo is as follows:</p><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/3-setupGithub/3.1-createTerraformRepo/003-createTerraformRepo.png></p><p>Here we have 3 main directories:</p><ol><li><strong>modules</strong>: contains Terraform modules.</li><li><strong>.github</strong>: contains GitHub workflow files, used to run GitHub actions.</li><li><strong>static</strong>: contains image directories for writing Readme.md files.</li></ol><p>In addition to files with the <strong>.tf</strong> extension, which I&rsquo;ll introduce later, we&rsquo;ll focus on the following files:</p><ol><li><strong>terraform-deploy.yml</strong>: is a YAML configuration file used in the pipeline of (CI/CD) to automatically deploy infrastructure using Terraform. Below is the content of the file.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy Infrastructure</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>actions</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Selecting actions for terraform&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#34;plan&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>choice</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>options</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>plan</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>apply</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>destroy</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Selecting evironments for terraform&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#34;staging&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>choice</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>options</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>staging</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>prod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>AWS_REGION </span>: <span style=color:#e6db74>&#34;us-east-1&#34;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>id-token</span>: <span style=color:#ae81ff>write</span> <span style=color:#75715e># This is required for requesting the JWT</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>contents</span>: <span style=color:#ae81ff>read </span> <span style=color:#75715e># This is required for actions/checkout</span>
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>DEPLOY INFRASTRUCTURE</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>: <span style=color:#ae81ff>${{ github.event.inputs.environment }}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Check out repository code</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Configure AWS Credentials</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>aws-actions/configure-aws-credentials@v4</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>aws-region</span>: <span style=color:#ae81ff>${{ env.AWS_REGION }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>role-to-assume</span>: <span style=color:#ae81ff>arn:aws:iam::590183956208:role/github-oidc-role</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>role-session-name</span>: <span style=color:#ae81ff>rolesession</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Get account id</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;AWS_ACCOUNT_ID=$ACCOUNT_ID&#34; &gt;&gt; $GITHUB_ENV</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Terraform</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>hashicorp/setup-terraform@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>terraform_version</span>: <span style=color:#ae81ff>1.7.3</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>terraform_wrapper</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Prepare Terraform</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>PROJECT_NAME</span>: <span style=color:#e6db74>&#34;workshop-02&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>STAGE_NAME</span>: <span style=color:#ae81ff>${{ github.event.inputs.environment }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>TERRAFORM_BUCKET_NAME</span>: <span style=color:#ae81ff>${{ secrets.TERRAFORM_BUCKET_NAME }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>CODESTAR_CONNECTION_ARN</span>: <span style=color:#ae81ff>${{  secrets.CODESTAR_CONNECTION_ARN }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>YOUR_GITHUB_REPOSITORY</span>: <span style=color:#e6db74>&#34;GitHubOrg/GitHubRepo&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>YOUR_GITHUB_BRANCH</span>: <span style=color:#e6db74>&#34;main&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          chmod +x setup.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          bash setup.sh
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          terraform init -backend-config=./vars.tfbackend</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Plan Terraform</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          terraform plan</span>          
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ github.event.inputs.actions == &#39;plan&#39; }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Aplly Terraform</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          terraform apply -auto-approve</span>          
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ github.event.inputs.actions == &#39;apply&#39; }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Destroy Terraform</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          terraform destroy -auto-approve</span>          
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ github.event.inputs.actions == &#39;destroy&#39; }}</span>
</span></span></code></pre></div><ul><li><p>With <strong>workflow_dispatch</strong>, it allows manual activation with inputs:</p><ul><li><strong>actions</strong>: Choose Terraform actions (plan, apply, destroy).</li><li><strong>environment</strong>: Choose environment (staging, prod).</li></ul></li><li><p>Setting up permissions for using OIDC, used in the step named <strong>Configure AWS Credentials</strong>:</p><ul><li><strong>id-token: write</strong> is the necessary permission to request JWT. With JWT to get temporary AWS authentication information.</li><li>You can read more here: <a href="https://github.com/aws-actions/configure-aws-credentials?tab=readme-ov-file#oidc">configure-aws-credentials</a></li></ul></li><li><p>Here, we pay attention to the important step named <strong>Prepare Terraform</strong>, in this step, we need to define the environment variables for the step, get and use variables from GitHub secrets.</p><ul><li>Besides the variables that you can understand by reading their names, there will be 2 variables representing the repository containing the source code for your application.<ul><li><strong>YOUR_GITHUB_REPOSITORY: &ldquo;GitHubOrg/GitHubRepo&rdquo;</strong></li><li><strong>YOUR_GITHUB_BRANCH: &ldquo;main&rdquo;</strong></li></ul></li><li>Then we will run the <strong>setup.sh</strong> script and initialize Terraform with backend configuration. This part might be confusing for those who are not familiar with Terraform, but don&rsquo;t worry, I&rsquo;ll explain it later.</li></ul></li></ul><ol start=2><li>About the <strong>setup.sh</strong> file.</li></ol><ul><li>After being executed, this file will create 2 files: <strong>terraform.tfvars</strong> and <strong>vars.tfbackend</strong>, containing variables for setting up Terraform.</li></ul><div class="notices info"><p>If you don&rsquo;t understand the contents of the workflow file, about GitHub action and its components, please read more about <a href=https://docs.github.com/en/actions>GitHub action</a> to better understand.</p></div><h4 id=regarding-secret-variables>Regarding secret variables</h4><p>Let&rsquo;s follow this flow to understand better:</p><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/3-setupGithub/3.1-createTerraformRepo/004-createTerraformRepo.png></p><p>When the workflow is triggered, GitHub action will proceed to retrieve secret variables and decrypt them to access the variable values. Because the variables are encrypted, the process is secure.</p><p>Next, the variables will be passed as follows:</p><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/3-setupGithub/3.1-createTerraformRepo/005-createTerraformRepo.png></p><ul><li>To the <strong>Prepare terraform</strong> step, where we have defined the variables for this step, it will create 2 files <strong>terraform.tfvars</strong> and <strong>vars.tfbackend</strong>. These are files containing the necessary variables to set up and pass variables to Terraform modules for use. When we have provided all the input variables, Terraform will be executed and infrastructure will be provisioned on AWS Cloud.</li></ul><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://bibichannel.github.io/workshop-02/3-setupgithub/ title="Prepare github repository"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://bibichannel.github.io/workshop-02/3-setupgithub/3.2-createstreamlitrepo/ title="Streamlit application" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://bibichannel.github.io/workshop-02/js/clipboard.min.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/perfect-scrollbar.min.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/perfect-scrollbar.jquery.min.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/jquery.sticky.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/featherlight.min.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/highlight.pack.js?1716562458></script><script>hljs.initHighlightingOnLoad()</script><script src=https://bibichannel.github.io/workshop-02/js/modernizr.custom-3.6.0.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/learn.js?1716562458></script><script src=https://bibichannel.github.io/workshop-02/js/hugo-learn.js?1716562458></script><link href=https://bibichannel.github.io/workshop-02/mermaid/mermaid.css?1716562458 rel=stylesheet><script src=https://bibichannel.github.io/workshop-02/mermaid/mermaid.js?1716562458></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>