<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.126.1"><meta name=description content><meta name=author content="journeyoftheaverageguy@gmail.com"><link rel=icon href=https://bibichannel.github.io/workshop-02/images/favicon.png type=image/png><title>Local :: Development & Deployment static website to AWS Cloud</title>
<link href=https://bibichannel.github.io/workshop-02/css/nucleus.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/fontawesome-all.min.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/hybrid.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/featherlight.min.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/perfect-scrollbar.min.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/auto-complete.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/atom-one-dark-reasonable.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/theme.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/hugo-theme.css?1716556005 rel=stylesheet><link href=https://bibichannel.github.io/workshop-02/css/theme-workshop.css?1716556005 rel=stylesheet><script src=https://bibichannel.github.io/workshop-02/js/jquery-3.3.1.min.js?1716556005></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.1-local/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://bibichannel.github.io/workshop-02/><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://bibichannel.github.io/workshop-02/js/lunr.min.js?1716556005></script><script type=text/javascript src=https://bibichannel.github.io/workshop-02/js/auto-complete.js?1716556005></script><script type=text/javascript>var baseurl="https://bibichannel.github.io/workshop-02/"</script><script type=text/javascript src=https://bibichannel.github.io/workshop-02/js/search.js?1716556005></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-introduce/ title=Introduction class=dd-item><a href=https://bibichannel.github.io/workshop-02/1-introduce/><b>1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/ title="Preparation " class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/><b>2. </b>Preparation
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/2-prerequisites/2.1-createiam/ title="Tạo User Groups và IAM User" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.1-createiam/><b>2.1 </b>Tạo User Groups và IAM User
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.2-createoidc/ title="Create OIDC" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.2-createoidc/><b>2.2 </b>Create OIDC
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.3-createbucket/ title="Create bucket" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.3-createbucket/><b>2.3 </b>Create bucket
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.4-createcodestar/ title="Create CodeStar Connection" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.4-createcodestar/><b>2.4 </b>Create CodeStar Connection
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/2-prerequisites/2.5-installtools/ title="Install tools" class=dd-item><a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.5-installtools/><b>2.5 </b>Install tools
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/3-setupgithub/ title="Prepare github repository" class=dd-item><a href=https://bibichannel.github.io/workshop-02/3-setupgithub/><b>3. </b>Prepare github repository
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-setupgithub/3.1-createterraformrepo/ title="Terraform IaC đến AWS Cloud" class=dd-item><a href=https://bibichannel.github.io/workshop-02/3-setupgithub/3.1-createterraformrepo/><b>3.1 </b>Terraform IaC đến AWS Cloud
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-setupgithub/3.2-createstreamlitrepo/ title="Streamlit application" class=dd-item><a href=https://bibichannel.github.io/workshop-02/3-setupgithub/3.2-createstreamlitrepo/><b>3.2 </b>Streamlit application
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-knowledgeterraform/ title="Knowledge Terraform" class=dd-item><a href=https://bibichannel.github.io/workshop-02/4-knowledgeterraform/><b>4. </b>Knowledge Terraform
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-knowledgeterraform/4.1-overview/ title=Overview class=dd-item><a href=https://bibichannel.github.io/workshop-02/4-knowledgeterraform/4.1-overview/><b>4.1 </b>Overview
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-knowledgeterraform/4.2-terraformflow/ title="Terrafrom flow" class=dd-item><a href=https://bibichannel.github.io/workshop-02/4-knowledgeterraform/4.2-terraformflow/><b>4.2 </b>Terrafrom flow
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-provisioningtesting/ title="Provisioning & Testing" class="dd-item
parent"><a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/><b>5. </b>Provisioning & Testing
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-provisioningtesting/5.1-local/ title=Local class="dd-item
active"><a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.1-local/><b>5.1 </b>Local
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-provisioningtesting/5.2-githubaction/ title="Git action" class=dd-item><a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.2-githubaction/><b>5.2 </b>Git action
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-cleanup/ title="Resource Cleanup" class=dd-item><a href=https://bibichannel.github.io/workshop-02/6-cleanup/><b>7. </b>Resource Cleanup
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.1-local/ selected>English</option><option id=vi value=https://bibichannel.github.io/workshop-02/vi/5-provisioningtesting/5.1-local/>Tiếng Việt</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><font color=orange>30-01-2022</font></i>
</left><left><br><br><b>Team</b><br><i><a href=https://www.linkedin.com/in/sutrinh/ style=color:orange>Sử Trịnh</a><br><a href=https://www.linkedin.com/in/jotaguy style=color:orange>Gia Hưng</a><br><a href=https://www.linkedin.com/in/hiepnguyendt style=color:orange>Thanh Hiệp </a></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://bibichannel.github.io/workshop-02/5-provisioning&amp;Testing/5.1-local/_index.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://bibichannel.github.io/workshop-02/>Development & Deployment static website to AWS Cloud</a> > <a href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/>Provisioning & Testing</a> > Local</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#chuẩn-bị>Chuẩn bị</a></li><li><a href=#tiến-hành-chạy>Tiến hành chạy</a></li><li><a href=#kiểm-tra-trên-aws-consonle>Kiểm tra trên AWS Consonle</a></li><li><a href=#destroy-cơ-sở-hạ-tầng>Destroy cơ sở hạ tầng</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Local</h1><h3 id=chuẩn-bị>Chuẩn bị</h3><p>Với việc chạy trên local thì chúng ta cần phải có thêm 2 tệp nữa là <strong>terraform.tfvars</strong> và <strong>vars.tfbackend</strong>. Hai tệp này sẽ gán value các biến môi trường đã được định nghĩa trong tệp variables.tf ở thư mục root và cấu hình backend lưu trữ trên S3 bucket.</p><ol><li>Với <strong>terraform.tfvars</strong> bạn sẽ có nội dung như sau:</li></ol><pre tabindex=0><code class=language-tfvars data-lang=tfvars>aws_region              = &#34;us-east-1&#34;
stage_name              = &#34;staging&#34;
project_name            = &#34;workshop-02&#34;
create_by               = &lt;Your name&gt;
github_repo             = &lt;GitHubOrg/GitHubRepo&gt;
github_branch           = &#34;main&#34;
codestar_connection_arn = &lt;CodeStar Conneciton ARN&gt;
account_id              = &lt;Account ID AWS&gt;
</code></pre><ul><li>Biến <strong>github_repo</strong> là tên của github repo chứa source code streamlit app tạo ở <a href=https://bibichannel.github.io/workshop-02/3-setupgithub/3.2-createstreamlitrepo/>bước 3.2</a>. Biến này được sử dụng cấu hình cho <strong>stage source</strong> của <strong>Codepipeline services</strong>.</li><li>Biến <strong>github_branch</strong> là nhánh của github repo chứa source code streamlit app bạn muốn theo dõi trạng thái. Biến này được sử dụng cấu hình cho <strong>stage source</strong> của <strong>Codepipeline services</strong>.</li><li>Biến <strong>codestar_connection_arn</strong> chứa ARN của Connection tạo ở <a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.4-createcodestar/>bước 2.4</a>. Biến này được dùng cho việc cấu hình <strong>stage source</strong> của <strong>Codepipeline services</strong>.</li><li>Biến <strong>account_id</strong> này chứa id của aws account của bạn, biến này được sử dụng cho việc tạo role của dịch vụ Amazon Simple Notification Service (SNS).</li><li>Ngoài các biến mình để cập các biến còn lại sẽ là các common variables cho các modules dùng hoặc để đánh tags các resources.</li><li></li></ul><ol start=2><li>Với <strong>vars.tfbackend</strong> bạn sẽ có nội dung như sau:</li></ol><pre tabindex=0><code class=language-tfbackend data-lang=tfbackend>bucket = &lt;Bucket&#39;s name&gt;
key    = &#34;terraform-staging/terraform.tfstate&#34;
region = &#34;us-east-1&#34;
</code></pre><ul><li>Với việc cấu hình <strong>backend</strong> cho terraform lưu trữ state file trên S3 sẽ cần khai báo những biến như trên. Việc sử dụng backend sẽ giúp ta khi code terraform có thể teamwork với nhau, bảo mật state file,&mldr;</li><li>Biến <strong>bucket</strong> chứa thông tin bucket bạn dùng để lưu backend mà ta đã tạo ở <a href=https://bibichannel.github.io/workshop-02/2-prerequisites/2.3-createbucket/>bước 2.3</a>.</li><li>Biến <strong>key</strong> cấu hình prefix cho đường dẫn tới file terraform trong bucket.</li><li>Biến <strong>region</strong> xác định xem bucket của bạn nằm ở region nào.</li><li>Bạn có thể đọc thêm thông tin về cách tạo backend cho terraform tại <a href=https://developer.hashicorp.com/terraform/language/settings/backends/s3>backend s3</a>.</li></ul><ol start=3><li>Bạn truy cập file <strong>main.tf</strong> ở root directory trong source code, tìm tới <strong>locals block</strong>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#a6e22e>locals</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Project</span>     = var.<span style=color:#a6e22e>project_name</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CreateBy</span>    = var.<span style=color:#a6e22e>create_by</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Environment</span> = var.<span style=color:#a6e22e>stage_name</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>container_name</span>     = <span style=color:#e6db74>&#34;streamlit-app&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>container_port</span>     = <span style=color:#ae81ff>8501</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>container_cpu</span>      = <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>container_memory</span>   = <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>notification_email</span> = <span style=color:#e6db74>&#34;trung.lykhanh150901@gmail.com&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Ngoài tags list chứa các key:value với value được pass từ <strong>terraform.tfvars</strong> file thì ta sẽ quan tâm tới các biến sau.</li><li><strong>container_name</strong> là biến đặt tên cho container trong cấu hình ECS services.</li><li><strong>container_port</strong> port của containter được expose.</li><li><strong>container_cpu</strong> giới hạn cpu cho fargate task definitions.</li><li><strong>notification_email</strong> là email được đăng ký với dịch vụ SNS, nhận thông báo change state của Codepipeline.</li></ul><p>Hãy thay đổi thông tin các biến cho phù hợp với bạn.</p><h3 id=tiến-hành-chạy>Tiến hành chạy</h3><p>Sau khi bạn đã có 2 tệp trên thì bây giờ bạn chạy lần lượt câu lệnh sau:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform init -backend-config<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;vars.tfbackend&#39;</span>
</span></span></code></pre></div><ul><li><p>Câu lệnh này sẽ tiến hành cài đặt các plugin cho provider bạn đã khai báo trong <strong>providers.tf</strong> file, khởi tạo một môi trường Terraform trong thư mục hiện tại. Cấu hình backend sử dụng các thông số từ <strong>vars.tfbackend</strong> file, thông qua cờ -<strong>backend-config</strong>. Load các module ta đã viết.</p></li><li><p>Dưới đây là hình ảnh sau khi chạy câu lệnh trên.</p></li></ul><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/001-local.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform validate
</span></span></code></pre></div><ul><li><p>Được sử dụng để kiểm tra xem tất cả các tệp cấu hình Terraform của bạn có đúng cú pháp và hợp lệ hay không, mà không cần thực hiện bất kỳ thay đổi nào đến hạ tầng thực tế. Điều này giúp bạn phát hiện lỗi cú pháp hoặc lỗi logic trước khi áp dụng bất kỳ thay đổi nào.</p></li><li><p>Dưới đây là hình ảnh sau khi chạy câu lệnh trên.</p></li></ul><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/002-local.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform plan
</span></span></code></pre></div><ul><li><p>Được sử dụng để tạo ra một kế hoạch thực hiện các thay đổi trên hạ tầng dựa trên cấu hình Terraform và state hiện tại mà không thực hiện các thay đổi thực tế. Điều này cho phép bạn xem trước những gì sẽ xảy ra nếu bạn áp dụng các thay đổi này.</p></li><li><p>Khi bạn chạy terraform plan, Terraform sẽ đọc cấu hình của bạn và state hiện tại, sau đó so sánh chúng để xác định những thay đổi cần thực hiện để đạt được trạng thái mới. Kết quả của lệnh này sẽ hiển thị danh sách các hành động mà Terraform sẽ thực hiện, bao gồm việc tạo, cập nhật hoặc xóa các tài nguyên.</p></li><li><p>Nó cũng cung cấp thông tin về tài nguyên nào sẽ được thay đổi, tài nguyên nào sẽ được thêm vào, và tài nguyên nào sẽ bị xóa (nếu có). Ngoài ra, nó cung cấp một ước lượng về chi phí và thời gian cần thiết để thực hiện các thay đổi.</p></li><li><p>Dưới đây là hình ảnh sau khi chạy câu lệnh trên.</p></li></ul><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/003-local.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform apply -auto-approve
</span></span></code></pre></div><ul><li><p>Lệnh terraform apply -auto-approve sẽ thực hiện áp dụng các thay đổi đã được kế hoạch bởi Terraform mà không cần xác nhận thêm từ người dùng. Điều này có nghĩa là Terraform sẽ tự động thực hiện các thay đổi mà không cần phải yêu cầu sự xác nhận nào từ bạn.</p></li><li><p>Dưới đây là hình ảnh sau khi chạy câu lệnh trên.</p></li></ul><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/004-local.png></p><ul><li>Sẽ có những resources mất thời gian để tạo nhưng sau khi tạo xong nó sẽ thông thông báo <strong>apply compelete</strong>.</li></ul><h3 id=kiểm-tra-trên-aws-consonle>Kiểm tra trên AWS Consonle</h3><p>Truy cập lần lượt các console sau để kiểm tra thông tin resources ta đã tạo:</p><ol><li>VPC console <a href="https://us-east-1.console.aws.amazon.com/vpcconsole/home?region=us-east-1#vpcs:">link</a></li><li>Codepipeline console <a href="https://us-east-1.console.aws.amazon.com/codesuite/codepipeline/pipelines?region=us-east-1">link</a></li><li>ECR console <a href="https://us-east-1.console.aws.amazon.com/ecr/private-registry/repositories?region=us-east-1">link</a></li><li>ECS console <a href="https://us-east-1.console.aws.amazon.com/ecs/v2/clusters?region=us-east-1">link</a></li><li>SNS topic console <a href="https://us-east-1.console.aws.amazon.com/sns/v3/home?region=us-east-1#/topics">link</a></li><li>EvenBridge rule console <a href="https://us-east-1.console.aws.amazon.com/events/home?region=us-east-1#/rules">link</a></li><li>Enpoint console <a href="https://us-east-1.console.aws.amazon.com/vpcconsole/home?region=us-east-1#Endpoints:">link</a></li><li>S3 bucket <a href="https://us-east-1.console.aws.amazon.com/s3/home?region=us-east-1">link</a></li><li>ALB console <a href="https://us-east-1.console.aws.amazon.com/ec2/home?region=us-east-1#LoadBalancers:">link</a></li></ol><p>Thông tin về state change của codepipeline được gửi về email đã đăng ký. Bạn nhớ check mail sớm để <strong>Subscription</strong> email của bạn cho SNS services nhé.</p><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/005-local.png></p><p>Truy cập thông tin sau dây để xem thử website đã được build.</p><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/006-local.png></p><table><thead><tr><th style=text-align:center>Container 1</th><th style=text-align:center>Container 2</th></tr></thead><tbody><tr><td style=text-align:center><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/007-local.png></td><td style=text-align:center><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/008-local.png></td></tr></tbody></table><p>Như ta thấy web đã hoạt động tốt, loadbalancer định tuyến traffic vào 2 container.</p><div class="notices info"><p>Bạn có để ý thấy ở đây mình dùng <strong>DNS</strong> của <strong>loadbalancer</strong>. Nhưng trong architect ban đầu có cấu hình thêm <strong>route53</strong> mà!!! Vì làm một mạch theo workshop luôn sẽ không đánh thức sự tò mò của bạn nên module cuối cùng mình sẽ để các bạn tự viết nó và triển khai một tên miền do chính các bạn đăng ký. Hãy thử thách bản thân và tạo nên một hệ thống hoàn chỉnh cho bức tranh này nhé. Mình tin bạn có thể làm được nếu đã đọc tới đây.</p></div><h4 id=thực-hiện-push-code-mới-lên-repository-streamlit-app>Thực hiện push code mới lên repository streamlit app</h4><p>Bạn hãy thay đổi bất kì đoạn mã hay văn bản nào trong thư mục chứa source code của streamlit app và push nó lên github.
Quay lại <a href="https://us-east-1.console.aws.amazon.com/codesuite/codepipeline/pipelines?region=us-east-1">Codepipeline console</a> để xem pipeline có được hoạt động đúng không. Check email trả về khi codepipeline thay đổi trạng thái và check ECS fargate services xem task đã được tạo mới hay chưa nhé.</p><h3 id=destroy-cơ-sở-hạ-tầng>Destroy cơ sở hạ tầng</h3><p>Chạy câu lệnh sau để huỷ cơ sở hạ tầng bạn đã provisioned.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>terraform destroy -auto-approve
</span></span></code></pre></div><p><img alt=image src=https://bibichannel.github.io/workshop-02/images/5-provisioning&Testing/5.1-local/009-local.png></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/ title="Provisioning & Testing"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://bibichannel.github.io/workshop-02/5-provisioningtesting/5.2-githubaction/ title="Git action" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://bibichannel.github.io/workshop-02/js/clipboard.min.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/perfect-scrollbar.min.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/perfect-scrollbar.jquery.min.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/jquery.sticky.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/featherlight.min.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/highlight.pack.js?1716556005></script><script>hljs.initHighlightingOnLoad()</script><script src=https://bibichannel.github.io/workshop-02/js/modernizr.custom-3.6.0.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/learn.js?1716556005></script><script src=https://bibichannel.github.io/workshop-02/js/hugo-learn.js?1716556005></script><link href=https://bibichannel.github.io/workshop-02/mermaid/mermaid.css?1716556005 rel=stylesheet><script src=https://bibichannel.github.io/workshop-02/mermaid/mermaid.js?1716556005></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>